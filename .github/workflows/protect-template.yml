name: Protect Template Repository

on:
  push:
    branches: [main]

jobs:
  check-commit-source:
    runs-on: ubuntu-latest
    steps:
      - name: Check if commit is from parent repo
        run: |
          # Check commit message for marker from parent repo
          if ! git log -1 --pretty=%B | grep -q "\[from-parent\]"; then
            echo "❌ ERROR: Direct commits to this repository are not allowed!"
            echo "This is a template repository. Changes must be made through:"
            echo "  https://github.com/pavel-lezhenin/python-templates"
            echo ""
            echo "To sync your local changes:"
            echo "  1. Clone python-templates repository"
            echo "  2. Make changes in packages/arch-layer-prod-mongo-fast/"
            echo "  3. Commit and push to python-templates"
            echo "  4. Submodule will be updated automatically"
            exit 1
          fi
          echo "✅ Commit is from parent repository"
